<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Weapon Viewer</title>
    <!-- Google Model Viewerの読み込み -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    <style>
        /* 背景を完全に透明にする設定 */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: transparent !important;
            overflow: hidden;
        }
        /* モデルビュワーの設定 */
        model-viewer {
            width: 100%;
            height: 100%;
            background-color: transparent;
            --poster-color: transparent;
        }
        /* 武器全体を動かすためのコンテナ */
        #container {
            width: 100%;
            height: 100%;
            /* 初期位置 */
            transform-origin: bottom right;
            transition: transform 0.05s linear; 
        }
    </style>
</head>
<body>

    <div id="container">
        <!-- src="knife.glb" の部分は自分のファイル名に変えてください -->
        <model-viewer
            src="melee_156.glb" 
            camera-controls
            disable-zoom
            disable-tap
            interaction-prompt="none"
            camera-orbit="-20deg 80deg 2.5m"
            field-of-view="30deg"
            shadow-intensity="1"
            environment-image="neutral"
        ></model-viewer>
    </div>

    <script>
        const container = document.getElementById('container');

        // Voxiom側（親ウィンドウ）からのメッセージを受け取る
        window.addEventListener('message', (event) => {
            // セキュリティのため、本来は送信元(origin)をチェックすべきですが
            // ローカルテスト用に一旦全許可しています
            
            const data = event.data;

            if (data.type === 'update-transform') {
                // 受け取った計算結果をCSSに適用
                container.style.transform = `
                    translate3d(${data.x}px, ${data.y}px, 0)
                    rotateY(${data.rotateY}deg)
                    rotateX(${data.rotateX}deg)
                `;
            }
        });
    </script>
</body>
</html>
